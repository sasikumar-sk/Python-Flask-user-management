<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=\, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='profile.css') }}">
    <title>Document</title>
    <style>
        .flash-messages {
            transform: translateX(-50%);
            z-index: 1000;
        }
        .flash-message {
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid transparent;
            border-radius: 5px;
            text-align: center;
        }
        .flash-success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }
        .flash-error {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }
    </style>
</head>
<body>
    <div style="display: flex;">
        {% include 'sidemenu.html'%}
    </div>
    <div class="container" style="width: 100rem;">
        <h1 style="text-align: center; margin-bottom:50px;" class="title">Profile</h1>
        </div> 

        <!-- Default avatar or profile image display (sasi) -->
          <div class="container" style="width: 35rem;">
        <div style="text-align: center;">
            {% if picture %}
                <img src="{{ picture }}" style="border-radius: 50%; height: 100px; width: 100px;">
            {% elif filename %}
                <img src='static/profile_images/{{filename}}' style="border-radius: 50%; height:100px; width:100px;">
            {% else %}    
                <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Default Avatar" style="border-radius: 50%; height: 100px; width: 100px;">
            {% endif %}
        </div>
        

        <!-- Removed edit button and icon (sasi) -->
    <form id="profileForm" action="{{ url_for('update_profile') }}" method="post" enctype="multipart/form-data" class="mt-4">

  <!-- Profile Picture Upload Field -->
  <div class="row mb-3 align-items-center">
    <label for="photo" class="col-sm-3 col-form-label">Profile Picture:</label>
    <div class="col-sm-9">
      <input type="file"
             class="form-control"
             id="photo"
             name="photo"
             accept="image/png, image/jpeg, image/jpg, image/x-icon">
    </div>
  </div>

  <!-- Name -->
  <div class="row mb-3 align-items-center">
    <label for="name" class="col-sm-3 col-form-label">Name:</label>
    <div class="col-sm-9">
      <input type="text" class="form-control" id="name" name="name" value="{{ name }}">
    </div>
  </div>

  <!-- Email -->
  <div class="row mb-3 align-items-center">
    <label for="email" class="col-sm-3 col-form-label">Email address:</label>
    <div class="col-sm-9">
      <input type="email" class="form-control" id="email" name="email" value="{{ emailId }}" readonly>
    </div>
  </div>

  <!-- Mobile -->
  <div class="row mb-3 align-items-center">
    <label for="mobile" class="col-sm-3 col-form-label">Mobile Number:</label>
    <div class="col-sm-9">
      <input type="text" class="form-control" id="mobile" name="mobile" value="{{ mobile }}">
    </div>
  </div>

  <!-- Password -->
  <div class="row mb-3 align-items-center">
    <label for="password" class="col-sm-3 col-form-label">Password:</label>
    <div class="col-sm-9">
      <input type="password" class="form-control" id="password" name="password" value="{{ password }}">
    </div>
  </div>

  <!-- Role -->
  <div class="row mb-4 align-items-center">
    <label for="role" class="col-sm-3 col-form-label">Role:</label>
    <div class="col-sm-9">
      {% if role == 'interviewer' %}
        <select class="form-control" id="role_display" disabled>
          <option selected>Interviewer</option>
        </select>
        <input type="hidden" name="role" value="interviewer">
      {% else %}
        <select class="form-control" id="role" name="role">
          <option value="admin" {% if role == 'admin' %}selected{% endif %}>Admin</option>
          <option value="user" {% if role == 'user' %}selected{% endif %}>User</option>
          <option value="interviewer" {% if role == 'interviewer' %}selected{% endif %}>Interviewer</option>
        </select>
      {% endif %}
    </div>
  </div>

  <!-- Submit & Back Buttons -->
  <div class="d-flex justify-content-center mb-5">
    <button type="submit" class="btn btn-primary me-3" style="width: 120px;">Submit</button>
    <a class="btn btn-outline-secondary"
       href="{{ url_for('Home') if role == 'admin' else url_for('dashBoard') }}"
       style="width: 120px;">
       <i class="fa-solid fa-backward me-2"></i>Back
    </a>
  </div>

</form>
        <div style="margin-left:40%; margin-top: 2rem;">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for category, message in messages %}
                            <div class="flash-message flash-{{ category }}">{{ message }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
        </div>
    </div>
  </div>
  <!-- JavaScript Validation for profile (sasi) -->
<script>
  document.getElementById('profileForm').addEventListener('submit', function (e) {
    const fileInput = document.getElementById('photo');
    const file = fileInput.files[0];

    if (file) {
      const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'image/x-icon'];
      if (!allowedTypes.includes(file.type)) {
        e.preventDefault(); // Stop form submission
        alert('Invalid file type! Please upload a .jpg, .jpeg, .png, or .ico image.');
        fileInput.value = ''; // Clear the invalid file
      }
    }
  });
</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</body>
</html>
