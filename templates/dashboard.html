<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/9fe3d1bfff.js" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/9fe3d1bfff.js" crossorigin="anonymous"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    
    <style>
      .card-body .row {
        margin-left: 0;
        margin-right: 0;
      }
      .card-body .col-6 {
        padding-left: 0;
        padding-right: 0;
      }
      .label{
          color:#00A9FF;
          font-size:18px;
      } 
      .filter{
        width: 90%;
        margin-left: 3rem;
      }  
      select{
        width: 7rem;
      }
      #divs,
      #sunburstChart,
      #roleSunburstChart {
        margin-left:20% !important;
      }
      .custom-carousel-btn {
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 50%;
        width: 35px;
        height: 35px;
        top: 50%;
        transform: translateY(-50%);
      }

      .custom-carousel-btn .carousel-control-prev-icon,
      .custom-carousel-btn .carousel-control-next-icon {
        filter: invert(1);
        width: 20px;
        height: 20px;
      }
            
    </style>
    <script>
      var project="{{project}}"
      var designation="{{designation}}"
      var locations="{{location}}"
      var leadBreakdowns = {{ lead_breakdowns | tojson }};
      
    </script>
  </head>
  <body>
    <div style="display: flex;">
      {% include 'sidemenu.html' %}
      
      <div class="content" style="padding:10px;  width:100%; margin-left: 150px;">

        {% if user_role == 'admin' %}
          <div>
            
            <h1 style="margin-bottom:3rem;"><center>Employee Dashboard</center></h1>
            <div class="filter_div">
              <div class="filter" style="display: flex; justify-content: space-between;margin-bottom: 10px;">
                <div >
                  <label for="project" class="label">Project:</label>
                  <select name="project" id="project" class="select_project" onchange="handleFilters()">
                    <option value=" ">Select</option>
                  </select>  
                </div>
                <div>
                  <label for="designation" class="label">Designation:</label>
                  <select name="designation" id="designation" onchange="handleFilters()">
                    <option value="">Select</option>
                  </select>
                  
                </div>
                <div>
                  <label for="location" class="label">Location:</label>
                  <select name="location" id="location" onchange="handleFilters()">
                    <option value="">Select</option>
                    
                  </select>
                </div>
                

            </div>
            <div class="flex_div" style="flex: 1; justify-content: space-between; ">
              <div class="row row-cols-1 row-cols-md-3 g-4" style="padding: 10px;">
                <div class="col" >
                  <div class="card h-100" >
                    
                    <div class="card-body" >
                      <i class="fa-solid fa-2x fa-users icons" style="margin-bottom: 20px;"></i>
                      
                      <p class="card-text">
                        Total number of employees: {{ employee_status_counts['Total'] }}
                      </p>
                      
                      <!-- Show other statuses -->
                      {% for status, count in employee_status_counts.items() %}
                        {% if status != 'Total' %}
                          <p class="card-text">Number of {{ status }} employees: {{ count }}</p>
                        {% endif %}
                      {% endfor %}
                      
                    </div>
                  </div>
                </div>
                
                
                <div class="col">
                  <div class="card h-80">
                    <div class="card-body" style="max-height:12.8rem; overflow-y: auto;">
                      <i class="fa-solid fa-location-dot fa-2x" style="color: black; margin-bottom: 10px;"></i>
                      {% for location, count in location_counts.items() %}
                        <p class="card-text" style="margin-bottom: 0.85rem;">{{ location }} employees count: {{ count }}</p>
                      {% endfor %}
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="card h-80">
                    <div class="card-body" style="max-height:12.8rem; overflow-y: auto;"> <!-- Set a fixed height and enable scrolling -->
                      
                      <div class="row" >
                        <div class="col-12"> <!-- Changed to a single column -->
                          <i class="fa-solid fa-clipboard-list icon fa-2x" style="margin-bottom: 10px;"></i>
                          {% for project, count in projects_counts.items() %}
                            <p style=" margin-bottom:1rem;">{{ project }} employees count: {{ count }}</p>
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col">
                  <div class="card h-80">
                    <div class="card-body" style="max-height:12.8rem; overflow-y: auto;">
                      <i class="fa-solid fa-briefcase icon fa-2x" style="margin-bottom: 10px;"></i>
                      {% for Emp_stat, count in Employment_status_counts.items() %}
                        <p class="card-text" style="margin-bottom: 0.85rem;">{{ Emp_stat }} employees count: {{ count }}</p>
                      {% endfor %}
                    </div>
                  </div>
                </div>
                
                <div class="col">
                  <div class="card h-100">
                    <div class="card-body">
                      <img src="https://banner2.cleanpng.com/20190724/geb/kisspng-product-design-technology-font-5d385089740a08.2768103715639717214753.jpg" height="50px" width="50px" class="icons">
                      <p class="card-text">No of Applications: {{total_resumes}}</p>
                      <p class="card-text">No of applications selected :{{hr_selected}}</p>
                    </div>
                  </div>
                </div>
                
                

                
                </div>
                
            </div>
            <hr>
          </div>
        {% endif %}  
      <h1 style="padding:10px;"><center>Resume Dashboard</center></h1>
      <div class="filter" style="display: flex; justify-content: space-between;margin-bottom: 10px;">
                <div>
                  <label for="week" class="label">Week:</label>
                  <select name="week" id="week" class="select_project" onchange="handleFilters()">
                    <option value=" ">Select</option>
                      {% for w in ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'] %}
                        <option value="{{ w }}" {% if w == week_filter %}selected{% endif %}>{{ w }}</option>
                      {% endfor %}
                  </select>  
                </div>
                <div>
                  <label for="month" class="label">Month:</label>
                  <select name="month" id="month" class="select_project" onchange="handleFilters()">
                    <option value=" ">Select</option>
                    {% for month in months %}
                        <option value="{{ month }}" {% if month == month_filter %}selected{% endif %}>{{ month }}</option>
                    {% endfor %}
                  </select>  
                </div>
                
                

            </div>
            <div class="flex_div" style="flex: 1; justify-content: center; margin-top: 5rem; margin-bottom: 10rem;">
              <div 
                  style=
                        "width: 60%; margin: auto;  box-shadow: 0 4px 20px black; 
                          border: 1px solid #dee2e6; border-radius: 20px; padding: 20px;">
                
                <div id="chartCarousel" class="carousel slide" data-bs-ride="carousel" >
                  <div class="carousel-inner">
                    <div class="carousel-item active">
                      <div id="divs"></div>
                    </div>
                    <div class="carousel-item">
                      <div id="sunburstChart"></div>
                    </div>
                    <div class="carousel-item">
                      <div id="roleSunburstChart"></div>
                    </div>
                  </div>
            
                  <!-- Carousel arrows (styled smaller + softer) -->
                  <button class="carousel-control-prev custom-carousel-btn" type="button" data-bs-target="#chartCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  </button>
                  <button class="carousel-control-next custom-carousel-btn" type="button" data-bs-target="#chartCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  </button>
                </div>
            
              </div>
            </div>
          
        <div >
        
        </div>
        </div>
    <script src="{{ url_for('static', filename='config.js') }}"></script>
    <script src="{{ url_for('static', filename='dashboard.js') }}"></script>
    <script>
      function handleFilters() {
        const url = new URL(window.location.href);

        function handleSelect(id, param) {
          const el = document.getElementById(id);
          if (el) {
            const val = el.value.trim();
            if (val === " ") {
              url.searchParams.delete(param);
            } else {
              url.searchParams.set(param, val);
            }
          }
        }

        handleSelect("project", "project");
        handleSelect("designation", "designation");
        handleSelect("location", "location");
        handleSelect("week", "week");
        handleSelect("month", "month");

        window.location.href = url.toString();
            }
    </script> 
    <script>
      const commonSize = 400;
      const commonTitleFont = { size: 20 };
      const commonMargin = { t: 30, l: 0, r: 0, b: 30 };
    
      // Lead-wise chart
      var data = [{
        type: "sunburst",
        labels: {{ labels | safe }},
        parents: {{ parents | safe }},
        values: {{ values | safe }},
        branchvalues: "total",
        outsidetextfont: { size: 16, color: "#000" },
        leaf: { opacity: 0.6 },
        marker: { line: { width: 2 } },
        hoverinfo: "label+value+percent parent"
      }];
      var layout = {
        margin: commonMargin,
        width: commonSize,
        height: commonSize,
        title: {
          text: "Interview Summary - Lead Wise",
          font: commonTitleFont
        },
        sunburstcolorway: ["#636efa", "#ef553b", "#00cc96", "#ab63fa"],
        extendsunburstcolorway: true
      };
      data[0].maxdepth = 2;
      Plotly.newPlot('sunburstChart', data, layout, { displayModeBar: false });
    
      // Role-wise chart
      var roleData = [{
        type: "sunburst",
        labels: {{ role_labels | safe }},
        parents: {{ role_parents | safe }},
        values: {{ role_values | safe }},
        branchvalues: "total",
        outsidetextfont: { size: 16, color: "#000" },
        leaf: { opacity: 0.6 },
        marker: { line: { width: 2 } },
        hoverinfo: "label+value+percent parent"
      }];
      var roleLayout = {
        margin: commonMargin,
        width: commonSize,
        height: commonSize,
        title: {
          text: "Interview Summary - Role Wise",
          font: commonTitleFont
        },
        sunburstcolorway: ["#19d3f3", "#ff6692", "#b6e880", "#ff97ff"],
        extendsunburstcolorway: true
      };
      roleData[0].maxdepth = 2;
      Plotly.newPlot('roleSunburstChart', roleData, roleLayout, { displayModeBar: false });
    
      // Pie chart
      var pieData = [{
          values: {{ chart_values | tojson }},
          labels: {{ chart_labels | tojson }},
          type: 'pie',
          textinfo: 'label+value',
          hoverinfo: 'label+value+percent',
          textposition: 'inside',
          insidetextorientation: 'radial',
          hole: 0.4,  // This turns it into a doughnut chart
          textfont: {
            size: 15
          },
          marker: {
            line: { width: 2 }
          },
          domain: {
            x: [0, 1],
            y: [0, 1]
          }
        }];

        var pieLayout = {
          title: {
            text: 'Interview Summary - Overall',
            font: commonTitleFont
          },
          showlegend: false,
          height: commonSize,
          width: commonSize,
          margin: commonMargin
        };

        Plotly.newPlot('divs', pieData, pieLayout, { displayModeBar: false });
    </script>
    
    
      

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>


    